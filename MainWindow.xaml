<Window x:Class="BusbarCAD.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BusbarCAD"
        mc:Ignorable="d"
        Title="Busbar CAD - MVP" Height="800" Width="1200"
        WindowState="Maximized">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Menu Bar -->
            <RowDefinition Height="Auto"/> <!-- Toolbar -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
            <RowDefinition Height="Auto"/> <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" Click="NewProject_Click"/>
                <MenuItem Header="_Open Project" Click="OpenProject_Click"/>
                <MenuItem Header="_Save Project" Click="SaveProject_Click"/>
                <Separator/>
                <MenuItem Header="_Export .bep Files" Click="Export_Click"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" Click="Undo_Click"/>
                <MenuItem Header="_Redo" Click="Redo_Click"/>
                <Separator/>
                <MenuItem Header="_Delete Busbar" Click="DeleteBusbar_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBar Grid.Row="1" Height="40">
            <Button Name="btnDraw" Click="DrawBusbar_Click" ToolTip="Draw Busbar (D)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="✏️" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Draw"/>
                </StackPanel>
            </Button>
            <Button Name="btnMove" Click="MovePoints_Click" ToolTip="Move Points (M)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⊕" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Move"/>
                </StackPanel>
            </Button>
            <Separator/>
            <Button Name="btnZoomIn" Click="ZoomIn_Click" ToolTip="Zoom In (+)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍+" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Zoom In"/>
                </StackPanel>
            </Button>
            <Button Name="btnZoomOut" Click="ZoomOut_Click" ToolTip="Zoom Out (-)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍-" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Zoom Out"/>
                </StackPanel>
            </Button>
            <Button Name="btnZoomFit" Click="ZoomFit_Click" ToolTip="Zoom to Fit (F)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⊡" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Fit"/>
                </StackPanel>
            </Button>
            <Separator/>
            <Button Name="btnHand" Click="Hand_Click" ToolTip="Hand Tool - Pan View (H)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="✋" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Pan"/>
                </StackPanel>
            </Button>
            <Separator/>
            <Button Name="btnExport" Click="Export_Click" ToolTip="Export .bep Files (Ctrl+E)">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📤" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Export"/>
                </StackPanel>
            </Button>
        </ToolBar>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/> <!-- Material Settings Panel -->
                <ColumnDefinition Width="*"/>   <!-- Canvas -->
                <ColumnDefinition Width="300"/> <!-- Segment List Panel -->
            </Grid.ColumnDefinitions>

            <!-- Material Settings Panel -->
            <Border Grid.Column="0" Background="#F0F0F0" BorderBrush="#CCCCCC" BorderThickness="0,0,1,0" Padding="10">
                <StackPanel>
                    <TextBlock Text="Material Settings" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>

                    <TextBlock Text="Busbar Width (mm):" Margin="0,5,0,2"/>
                    <ComboBox Name="cmbBusbarWidth" SelectionChanged="BusbarWidth_Changed">
                        <ComboBoxItem>20</ComboBoxItem>
                        <ComboBoxItem>30</ComboBoxItem>
                        <ComboBoxItem>40</ComboBoxItem>
                        <ComboBoxItem>50</ComboBoxItem>
                        <ComboBoxItem>60</ComboBoxItem>
                        <ComboBoxItem IsSelected="True">80</ComboBoxItem>
                        <ComboBoxItem>100</ComboBoxItem>
                        <ComboBoxItem>120</ComboBoxItem>
                        <ComboBoxItem>160</ComboBoxItem>
                        <ComboBoxItem>200</ComboBoxItem>
                    </ComboBox>

                    <TextBlock Text="Layer Spacing (mm):" Margin="0,10,0,2"/>
                    <TextBox Name="txtLayerSpacing" Text="20" LostFocus="MaterialSettings_Changed"/>

                    <TextBlock Text="Bend Tool Radius (mm):" Margin="0,10,0,2"/>
                    <TextBox Name="txtToolRadius" Text="20" LostFocus="MaterialSettings_Changed"/>

                    <TextBlock Text="K-Factor:" Margin="0,10,0,2"/>
                    <TextBox Name="txtKFactor" Text="0.9" LostFocus="MaterialSettings_Changed"/>

                    <TextBlock Text="Thickness (mm):" Margin="0,10,0,2"/>
                    <TextBox Name="txtThickness" Text="10" IsReadOnly="True" Background="#E0E0E0"/>

                    <Separator Margin="0,20,0,10"/>

                    <TextBlock Text="Current Layer:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock Name="txtCurrentLayer" Text="Layer 1" Margin="0,0,0,10"/>

                    <TextBlock Text="Busbars:" FontWeight="Bold" Margin="0,10,0,5"/>
                    <ListBox Name="lstBusbars" Height="200" SelectionChanged="Busbar_SelectionChanged"/>

                    <Separator Margin="0,20,0,10"/>

                    <TextBlock Text="Validation Status:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock Name="txtValidationStatus" Text="Ready" Foreground="Green" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Canvas Area -->
            <Border Grid.Column="1" Background="White" ClipToBounds="True">
                <Canvas Name="drawingCanvas"
                        Background="White"
                        ClipToBounds="True"
                        Focusable="True"
                        MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                        MouseMove="Canvas_MouseMove"
                        MouseRightButtonDown="Canvas_MouseRightButtonDown"
                        SizeChanged="DrawingCanvas_SizeChanged">
                    <!-- Grid background (optional) -->

                    <!-- Instruction overlay when no busbars -->
                    <TextBlock Name="txtInstructions"
                               Text="Click 'Draw' button or press 'D' to start drawing a busbar.&#x0a;Click points to create segments. Right-click or press ESC to finish."
                               Canvas.Left="0"
                               Canvas.Top="0"
                               FontSize="16"
                               Foreground="#999999"
                               TextAlignment="Center"
                               IsHitTestVisible="False"/>

                    <!-- Move Points Controls (Hidden by default) -->
                    <Grid Name="moveControlsGrid" Visibility="Collapsed" Canvas.Left="20" Canvas.Top="20" Width="84" Height="90">
                        <!-- Drag Handle -->
                        <Border Name="moveDragHandle" Width="84" Height="12" VerticalAlignment="Top" Background="#E0E0E0"
                                BorderBrush="#AAAAAA" BorderThickness="1" CornerRadius="2"
                                MouseLeftButtonDown="MoveDragHandle_MouseDown" MouseMove="MoveDragHandle_MouseMove" MouseLeftButtonUp="MoveDragHandle_MouseUp"
                                Cursor="SizeAll">
                            <TextBlock Text="⋮⋮⋮" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="8" Foreground="#666666"/>
                        </Border>

                        <!-- Arrow Controls (shifted down to make room for drag handle) -->
                        <Grid Margin="0,12,0,0">
                            <!-- Up Arrow -->
                            <Button Name="btnMoveUp" Width="28" Height="21" HorizontalAlignment="Center" VerticalAlignment="Top" Click="MoveDirection_Click" Tag="Up" Background="LightGray">
                                <TextBlock Text="↑" FontSize="14" FontWeight="Bold"/>
                            </Button>

                            <!-- Down Arrow -->
                            <Button Name="btnMoveDown" Width="28" Height="21" HorizontalAlignment="Center" VerticalAlignment="Bottom" Click="MoveDirection_Click" Tag="Down" Background="LightGray">
                                <TextBlock Text="↓" FontSize="14" FontWeight="Bold"/>
                            </Button>

                            <!-- Left Arrow -->
                            <Button Name="btnMoveLeft" Width="21" Height="28" HorizontalAlignment="Left" VerticalAlignment="Center" Click="MoveDirection_Click" Tag="Left" Background="LightGray">
                                <TextBlock Text="←" FontSize="14" FontWeight="Bold"/>
                            </Button>

                            <!-- Right Arrow -->
                            <Button Name="btnMoveRight" Width="21" Height="28" HorizontalAlignment="Right" VerticalAlignment="Center" Click="MoveDirection_Click" Tag="Right" Background="LightGray">
                                <TextBlock Text="→" FontSize="14" FontWeight="Bold"/>
                            </Button>

                            <!-- Center Dimension Input -->
                            <TextBox Name="txtMoveDimension" Width="35" Height="21" HorizontalAlignment="Center" VerticalAlignment="Center"
                                     TextAlignment="Center" FontSize="10" Background="White"
                                     PreviewKeyDown="MoveDimension_KeyDown" TextChanged="MoveDimension_TextChanged"/>
                        </Grid>
                    </Grid>
                </Canvas>
            </Border>

            <!-- Segment List Panel -->
            <Border Grid.Column="2" Background="#F0F0F0" BorderBrush="#CCCCCC" BorderThickness="1,0,0,0" Padding="10">
                <StackPanel>
                    <TextBlock Text="Current Busbar Segments" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>

                    <!-- Busbar Name -->
                    <TextBlock Text="Busbar Name:" Margin="0,0,0,5"/>
                    <TextBox Name="txtBusbarName" Text="a" Margin="0,0,0,15" FontSize="14" TextChanged="txtBusbarName_TextChanged"/>

                    <DataGrid Name="dgSegments"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              GridLinesVisibility="All"
                              HeadersVisibility="Column"
                              Height="Auto"
                              CellEditEnding="DataGrid_CellEditEnding"
                              PreparingCellForEdit="DataGrid_PreparingCellForEdit">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Angle (°)" Binding="{Binding BendAngle, StringFormat=F1, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" Width="*" IsReadOnly="False"/>
                            <DataGridTextColumn Header="Length (mm)" Binding="{Binding Length, StringFormat=F1, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" Width="*" IsReadOnly="False"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Height="25">
            <StatusBarItem>
                <TextBlock Name="txtStatusBar" Text="Ready"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
